<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
  <body>
    <header th:fragment="siteHeader" class="site-header gradient-hero">
      <div class="container inner">
        <!-- Brand -->
        <div class="brand">
          <div class="mark"></div>
          <strong class="name">AloTraBong</strong>
        </div>

        <!-- Nav -->
        <nav class="nav">
          <a th:href="@{/user/home}">Trang ch·ªß</a>
          <a th:href="@{/user/product/list}">Menu</a>
          <a th:href="@{/user/coupon/list}">∆Øu ƒë√£i</a>
          <a th:href="@{/user/branches}">Chi nh√°nh</a>
          <a href="#contact" class="btn btn-primary cta">Li√™n h·ªá</a>
        </nav>

        <!-- Tools -->
        <div class="header-tools">
          <a th:href="@{/user/cart}" class="cart-badge">
            üõí <b th:text="${cartCount} ?: 0">0</b>
          </a>
          <a th:href="@{/user/order/history}">ƒê∆°n h√†ng</a>
          <a th:href="@{/user/addresses}">ƒê·ªãa ch·ªâ</a>
          <a th:href="@{/user/favorite/list}">Y√™u th√≠ch</a>

          <!-- ACCOUNT -->
          <div
            class="account-box"
            th:classappend="${userName} != null ? ' is-auth' : ' is-guest'"
          >
            <!-- N·∫øu ƒë√£ ƒëƒÉng nh·∫≠p -->
            <button
              class="account-trigger"
              type="button"
              id="accountTrigger"
              th:if="${userName != null}"
            >
              <span
                class="account-avatar"
                th:text="${#strings.substring((userName?:'U'),0,1)}"
              >U</span>
            </button>

            <!-- N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p -->
            <a
              th:href="@{/auth/login}"
              th:if="${userName == null}"
              class="login-btn"
            >
              ƒêƒÉng nh·∫≠p
            </a>

            <!-- Dropdown (ch·ªâ render n·∫øu login) -->
            <div
              class="account-dropdown"
              id="accountDropdown"
              hidden
              th:if="${userName != null}"
            >
              <a th:href="@{/user/profile}" class="dropdown-item">
                Th√¥ng tin c√° nh√¢n
              </a>

              <hr class="dropdown-sep" />

              <form th:action="@{/logout}" method="post">
                <input
                  type="hidden"
                  th:name="${_csrf?.parameterName}"
                  th:value="${_csrf?.token}"
                />
                <button type="submit" class="dropdown-item logout">
                  ƒêƒÉng xu·∫•t
                </button>
              </form>
            </div>
          </div>
          <!-- /account-box -->
        </div>
      </div>

      <!-- style c∆° b·∫£n, kh√¥ng m√†u m√® -->
      <style>
        .account-box {
          position: relative;
          display: flex;
          align-items: center;
          font-size: 14px;
        }

        /* n√∫t m·ªü dropdown */
        .account-trigger {
          display: flex;
          align-items: center;
          gap: 6px;
          cursor: pointer;
          background: transparent;
          border: 0;
          padding: 4px 6px;
          font: inherit;
          color: inherit;
        }

        .account-avatar {
          width: 28px;
          height: 28px;
          min-width: 28px;
          border-radius: 50%;
          background: #222;
          color: #fff;
          font-size: 13px;
          font-weight: 600;
          line-height: 28px;
          text-align: center;
          text-transform: uppercase;
        }

        .account-username {
          max-width: 120px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          font-size: 13px;
          line-height: 1.2;
        }

        /* n√∫t ƒêƒÉng nh·∫≠p khi ch∆∞a login */
        .login-btn {
          display: inline-block;
          padding: 6px 12px;
          font-size: 14px;
          font-weight: 600;
          color: #fff;
          background-color: #1f2937; /* x√°m ƒë·∫≠m */
          border: 1px solid #4b5563; /* vi·ªÅn x√°m */
          border-radius: 6px;
          text-decoration: none;
          line-height: 1;
          transition: background-color 0.15s, border-color 0.15s;
        }
        .login-btn:hover {
          background-color: #374151; /* hover s√°ng nh·∫π */
          border-color: #6b7280;
        }

        /* h·ªôp dropdown */
        .account-dropdown {
          position: absolute;
          top: calc(100% + 6px);
          right: 0;
          min-width: 180px;
          background: #fff;
          border: 1px solid #d1d5db; /* x√°m nh·∫°t */
          border-radius: 6px;
          box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
          padding: 6px 0;
          font-size: 14px;
          line-height: 1.4;
          z-index: 1000;
        }

        .dropdown-item {
          display: block;
          width: 100%;
          text-align: left;
          background: none;
          border: 0;
          font: inherit;
          cursor: pointer;
          text-decoration: none;

          padding: 8px 12px;
          color: #111;
        }

        .dropdown-item:hover {
          background: #f3f4f6; /* x√°m nh·∫π */
        }

        .dropdown-sep {
          border: 0;
          border-top: 1px solid #e5e7eb;
          margin: 6px 0;
        }

        .dropdown-item.logout {
          color: #dc2626; /* ƒë·ªè nh·∫°t c·∫£nh b√°o */
          font-weight: 500;
          width: 100%;
          text-align: left;
        }
        .dropdown-item.logout:hover {
          background: #fee2e2;
        }
      </style>

      <!-- JS toggle dropdown -->
      <script>
        (function () {
          const trigger = document.getElementById("accountTrigger");
          const dropdown = document.getElementById("accountDropdown");

          // n·∫øu ch∆∞a login th√¨ thymeleaf kh√¥ng render trigger/dropdown => kh√¥ng l√†m g√¨
          if (!trigger || !dropdown) return;

          function closeDropdown() {
            if (!dropdown.hasAttribute("hidden")) {
              dropdown.setAttribute("hidden", "");
            }
          }

          function toggleDropdown() {
            if (dropdown.hasAttribute("hidden")) {
              dropdown.removeAttribute("hidden");
            } else {
              dropdown.setAttribute("hidden", "");
            }
          }

          // click avatar -> toggle
          trigger.addEventListener("click", function (e) {
            e.stopPropagation();
            toggleDropdown();
          });

          // click ra ngo√†i -> ƒë√≥ng
          document.addEventListener("click", function (e) {
            if (!e.target.closest(".account-box")) {
              closeDropdown();
            }
          });

          // nh·∫•n Esc -> ƒë√≥ng
          document.addEventListener("keydown", function (e) {
            if (e.key === "Escape") {
              closeDropdown();
            }
          });
        })();
      </script>
    </header>
  </body>
</html>
