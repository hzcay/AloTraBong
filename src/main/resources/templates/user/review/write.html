<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
      th:replace="~{fragments/layout :: layout(~{::content}, 'Viết đánh giá')}">
<div th:fragment="content">

  <section class="section">
    <div class="container" style="max-width:820px">
      <header class="section-head">
        <h2 class="section-title m-0">Viết đánh giá</h2>
        <a th:href="@{${backUrl} ?: '/orders'}" class="btn">← Quay lại</a>
      </header>

      <!-- Thông tin món/đơn -->
      <div class="card pad mb-2">
        <div class="center" style="gap:12px;justify-content:flex-start">
          <div class="card" style="width:64px;height:64px;overflow:hidden">
            <img th:src="${product.thumbnailUrl}" alt="" style="width:100%;height:100%;object-fit:cover">
          </div>
          <div>
            <b th:text="${product.name}">Tên món</b>
            <div class="text-muted">
              Đơn: <b th:text="${orderCode}">ALB12345</b> • Đã giao: <b th:text="${#temporals.format(deliveredAt,'dd/MM/yyyy')}">--</b>
            </div>
          </div>
        </div>
      </div>

      <!-- Form review -->
      <div class="card pad">
        <form th:action="@{/review/submit}" method="post" enctype="multipart/form-data" class="grid" style="gap:12px">
          <input type="hidden" name="orderCode" th:value="${orderCode}">
          <input type="hidden" name="productId" th:value="${product.id}">

          <label class="grid">
            <span class="text-muted">Chấm điểm</span>
            <select class="select" name="rating" required>
              <option th:each="r : ${#numbers.sequence(5,1)}" th:value="${r}" th:text="${r + ' ★'}"></option>
            </select>
          </label>

          <label class="grid">
            <span class="text-muted">Nội dung (≥ 50 ký tự)</span>
            <textarea class="textarea" name="content" rows="5" minlength="50" required
                      placeholder="Chia sẻ cảm nhận về hương vị, độ nóng, khẩu vị, đóng gói, giao hàng…"></textarea>
          </label>

          <label class="grid">
            <span class="text-muted">Ảnh/Video (tuỳ chọn)</span>
            <input class="input" type="file" name="media" multiple accept="image/*,video/*">
          </label>

          <div class="center" style="gap:8px;justify-content:flex-start">
            <button class="btn btn-primary" type="submit">Gửi đánh giá</button>
            <a th:href="@{${backUrl} ?: '/orders'}" class="btn">Hủy</a>
          </div>

          <div th:if="${error != null}" class="badge" style="border-color:#fecaca;color:#991b1b">[[${error}]]</div>
          <div th:if="${success != null}" class="badge" style="border-color:#a7f3d0;color:#065f46">[[${success}]]</div>
        </form>
      </div>
    </div>
  </section>

</div>
</html>
