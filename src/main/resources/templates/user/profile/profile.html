<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  lang="vi"
  th:replace="~{fragments/layout :: layout(~{::content}, 'Hồ sơ cá nhân')}"
>
  <div th:fragment="content">
    <!-- HEADER -->
    <section class="section">
      <div class="container">
        <div class="center-between" style="gap:12px;flex-wrap:wrap">
          <div>
            <h1 class="m-0" style="font-weight:800;font-size:22px">Hồ sơ cá nhân</h1>
            <div class="text-muted" style="font-size:13px">Thông tin tài khoản & bảo mật</div>
          </div>
          <a class="btn" th:href="@{/}">← Trang chủ</a>
        </div>
      </div>
    </section>

    <!-- BODY -->
    <section class="section">
      <div class="container grid" style="grid-template-columns: 0.55fr 1fr; gap:20px; align-items:start">
        <!-- LEFT: Hiển thị -->
        <aside class="card pad">
          <div class="center" style="gap:12px;justify-content:flex-start">
            <div style="width:56px;height:56px;border-radius:50%;background:#eef2ff;display:grid;place-items:center;font-weight:700;color:#4f46e5">
              <span th:text="${#strings.substring(profile?.fullName,0,1)}">U</span>
            </div>
            <div>
              <div class="bold" th:text="${profile?.fullName}">Nguyễn Văn A</div>
              <div class="text-muted" th:text="${profile?.email}">user@email.com</div>
            </div>
          </div>

          <hr style="margin:14px 0;border-color:#eee"/>

          <div class="grid" style="gap:10px">
            <div>
              <div class="text-muted" style="font-size:12px">Số điện thoại</div>
              <div th:text="${profile?.phone}">090xxxxxxx</div>
            </div>
            <!-- ĐÃ BỎ ĐỊA CHỈ  -->
          </div>
        </aside>

        <!-- RIGHT: Forms -->
        <section class="grid" style="gap:20px">
          <!-- Form 1: Cập nhật hồ sơ -->
          <section class="card pad">
            <h3 class="m-0 mb-2 bold">Cập nhật hồ sơ</h3>

            <!-- thông báo -->
            <div th:if="${error != null}" class="badge" style="border-color:#fecaca;color:#991b1b">[[${error}]]</div>
            <div th:if="${saved != null}" class="badge" style="border-color:#bbf7d0;color:#166534">[[${saved}]]</div>

            <form th:action="@{/user/profile/update}" method="post" class="grid" style="gap:12px">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

              <label class="grid">
                <span class="text-muted">Họ và tên</span>
                <input class="input" name="fullName" th:value="${form?.fullName}" required maxlength="120"/>
              </label>

              <label class="grid">
                <span class="text-muted">Email</span>
                <input class="input" type="email" name="email" th:value="${form?.email}" required maxlength="190"/>
              </label>

              <label class="grid">
                <span class="text-muted">Số điện thoại</span>
                <input class="input" name="phone" th:value="${form?.phone}" required maxlength="20" pattern="0[0-9]{9,10}"/>
              </label>

              <div class="center" style="gap:8px;justify-content:flex-start">
                <button class="btn btn-primary" type="submit">Lưu thay đổi</button>
                <a class="btn" th:href="@{/user/profile}">Hủy</a>
              </div>
            </form>
          </section>

          <!-- Form 2: Đổi mật khẩu -->
          <section class="card pad">
            <h3 class="m-0 mb-2 bold">Đổi mật khẩu</h3>

            <div th:if="${pwdError != null}" class="badge" style="border-color:#fecaca;color:#991b1b">[[${pwdError}]]</div>
            <div th:if="${pwdSaved != null}" class="badge" style="border-color:#bbf7d0;color:#166534">[[${pwdSaved}]]</div>

            <form th:action="@{/user/profile/change-password}" method="post" class="grid" style="gap:12px" autocomplete="off">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

              <label class="grid">
                <span class="text-muted">Mật khẩu hiện tại</span>
                <input class="input" type="password" name="currentPassword" required minlength="6" maxlength="128"/>
              </label>

              <label class="grid">
                <span class="text-muted">Mật khẩu mới</span>
                <input class="input" type="password" name="newPassword"
                       required minlength="8" maxlength="128"
                       pattern="^(?=.*[A-Za-z])(?=.*\d).{8,}$"
                       title="Tối thiểu 8 ký tự, có chữ và số"/>
              </label>

              <label class="grid">
                <span class="text-muted">Xác nhận mật khẩu mới</span>
                <input class="input" type="password" name="confirmPassword" required minlength="8" maxlength="128"/>
              </label>

              <div class="text-muted" style="font-size:12px">
                Gợi ý an toàn: dùng ít nhất 8 ký tự, pha trộn chữ cái + số (có thể thêm ký tự đặc biệt cho chắc kèo).
              </div>

              <div class="center" style="gap:8px;justify-content:flex-start">
                <button class="btn btn-primary" type="submit">Cập nhật mật khẩu</button>
              </div>
            </form>
          </section>
        </section>
      </div>
    </section>
  </div>
</html>
