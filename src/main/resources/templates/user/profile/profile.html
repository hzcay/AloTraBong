<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  lang="vi"
  th:replace="~{fragments/layout :: layout(~{::content}, 'Hồ sơ cá nhân')}"
>
  <div th:fragment="content">
    <!-- HEADER -->
    <section class="section">
      <div class="container">
        <div class="center-between" style="gap:12px;flex-wrap:wrap">
          <div>
            <h1 class="m-0" style="font-weight:800;font-size:22px">Hồ sơ cá nhân</h1>
            <div class="text-muted" style="font-size:13px">Thông tin tài khoản & liên hệ</div>
          </div>
          <a class="btn" th:href="@{/}">← Trang chủ</a>
        </div>
      </div>
    </section>

    <!-- BODY -->
    <section class="section">
      <div class="container grid" style="grid-template-columns: 0.55fr 1fr; gap:20px; align-items:start">
        <!-- LEFT: Hiển thị -->
        <aside class="card pad">
          <div class="center" style="gap:12px;justify-content:flex-start">
            <div style="width:56px;height:56px;border-radius:50%;background:#eef2ff;display:grid;place-items:center;font-weight:700;color:#4f46e5">
              <span th:text="${#strings.substring(profile?.fullName,0,1)}">U</span>
            </div>
            <div>
              <div class="bold" th:text="${profile?.fullName}">Nguyễn Văn A</div>
              <div class="text-muted" th:text="${profile?.email}">user@email.com</div>
            </div>
          </div>

          <hr style="margin:14px 0;border-color:#eee"/>

          <div class="grid" style="gap:10px">
            <div>
              <div class="text-muted" style="font-size:12px">Số điện thoại</div>
              <div th:text="${profile?.phone}">090xxxxxxx</div>
            </div>
            <div>
              <div class="text-muted" style="font-size:12px">Địa chỉ</div>
              <div th:text="${profile?.address}">Số nhà, đường, quận/huyện, tỉnh/thành</div>
            </div>
          </div>
        </aside>

        <!-- RIGHT: Form cập nhật -->
        <section class="card pad">
          <h3 class="m-0 mb-2 bold">Cập nhật hồ sơ</h3>

          <!-- thông báo -->
          <div th:if="${error != null}" class="badge" style="border-color:#fecaca;color:#991b1b">[[${error}]]</div>
          <div th:if="${saved != null}" class="badge" style="border-color:#bbf7d0;color:#166534">[[${saved}]]</div>

          <form th:action="@{/user/profile/update}" method="post" class="grid" style="gap:12px">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <label class="grid">
              <span class="text-muted">Họ và tên</span>
              <input class="input" name="fullName" th:value="${form?.fullName}" required maxlength="120"/>
            </label>

            <label class="grid">
              <span class="text-muted">Email</span>
              <input class="input" type="email" name="email" th:value="${form?.email}" required maxlength="190"/>
            </label>

            <label class="grid">
              <span class="text-muted">Số điện thoại</span>
              <input class="input" name="phone" th:value="${form?.phone}" required maxlength="20" pattern="0[0-9]{9,10}"/>
            </label>

            <label class="grid">
              <span class="text-muted">Địa chỉ</span>
              <textarea class="input" name="address" rows="3" th:text="${form?.address}" required maxlength="500"></textarea>
            </label>

            <div class="center" style="gap:8px;justify-content:flex-start">
              <button class="btn btn-primary" type="submit">Lưu thay đổi</button>
              <a class="btn" th:href="@{/user/profile}">Hủy</a>
            </div>
          </form>
        </section>
      </div>
    </section>
  </div>
</html>
