<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
      th:replace="~{fragments/layout :: layout(~{::content}, 'Ma giam gia')}">
<div th:fragment="content">

  <section class="section">
    <div class="container">
      <header class="section-head">
        <h2 class="section-title m-0">Ma giam gia</h2>

        <!-- Nhap ma thu cong -->
        <form th:action="@{/user/coupons/apply}" method="post" class="center" style="gap:10px;flex-wrap:wrap">
          <input class="input" name="code" placeholder="Nhap ma..." style="max-width:260px;border-style:dashed">
          <button class="btn btn-primary" type="submit">Ap dung</button>

          <!-- Bao loi -->
          <div th:if="${error != null}" class="text-muted" style="color:var(--danger)">
            <b th:text="${error}">Ma khong hop le</b>
          </div>

          <!-- Bao ma da ap dung -->
          <div th:if="${applied != null}" class="badge">
            Da ap dung: <b th:text="${applied.code}">ALO20</b>
          </div>
        </form>
      </header>

      <!-- Khi khong co coupon -->
      <div th:if="${#lists.isEmpty(coupons)}" class="card pad text-muted">
        Hien chua co coupon kha dung.
      </div>

      <!-- Danh sach coupon -->
      <div class="grid grid-3" th:if="${!#lists.isEmpty(coupons)}">
        <article class="card pad" th:each="c : ${coupons}" style="border:1px solid #000;">
          <div class="center-between mb-1">
            <h3 class="m-0 bold" th:text="${c.code}">ALO20</h3>
            <span class="badge" th:text="${c.discountType}">PERCENT</span>
          </div>

          <p class="text-muted m-0 mb-2" th:text="${c.description}">
            Giam 20% cho don hang tu 100k.
          </p>

          <div class="center-between">
            <span class="text-muted">HSD:
              <b th:text="${#temporals.format(c.endDate, 'dd/MM/yyyy')}">--</b>
            </span>
            <form th:action="@{/user/coupons/apply}" method="post">
              <input type="hidden" name="code" th:value="${c.code}">
              <button class="btn" type="submit">Dung ngay</button>
            </form>
          </div>
        </article>
      </div>

      <div class="center" style="gap:8px;margin-top:16px">
        <a th:href="@{/user/cart}" class="btn">Ve gio hang</a>
        <a th:href="@{/user/checkout}" class="btn btn-primary">Toi thanh toan â†’</a>
      </div>
    </div>
  </section>

</div>
</html>
